angular.module("panzoom",["monospaced.mousewheel"]).directive("panzoom",["$document","PanZoomService",function(a,b){var c={};return{restrict:"E",transclude:!0,scope:{config:"=",model:"="},controller:["$scope","$element",function(d,e){function f(){C.isRegistered||(C.isRegistered=!0,m?m(C):jQuery.fx.timer(C))}var g,h=e,i=e.find(".pan-element"),j=e.find(".zoom-element"),k=i.get(0),l=j.get(0),m=window.requestAnimationFrame||window.mozRequestAnimationFrame,n=a.find("#PanZoomOverlay");0===n.length?(g=$('<div id="PanZoomOverlay" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; opacity: 0; display: none;"></div>'),a.find("body").append(g)):g=n;var o=function(a){return Math.pow(d.config.scalePerZoomLevel,a-d.config.neutralZoomLevel)},p=function(a){return Math.log(a)/Math.log(d.config.scalePerZoomLevel)+d.config.neutralZoomLevel};d.config.disableZoomAnimation=d.config.disableZoomAnimation||!1,d.config.zoomLevels=d.config.zoomLevels||5,d.config.neutralZoomLevel=d.config.neutralZoomLevel||2,d.config.friction=d.config.friction||10,d.config.haltSpeed=d.config.haltSpeed||100,d.config.scalePerZoomLevel=d.config.scalePerZoomLevel||2,d.config.zoomStepDuration=d.config.zoomStepDuration||.2,d.config.zoomStepDuration=d.config.zoomStepDuration||.2,d.config.modelChangedCallback=d.config.modelChangedCallback||function(){},d.config.zoomToFitZoomLevelFactor=d.config.zoomToFitZoomLevelFactor||.95,d.config.zoomButtonIncrement=d.config.zoomButtonIncrement||1,d.config.useHardwareAcceleration=d.config.useHardwareAcceleration||!1,d.config.initialZoomLevel=d.config.initialZoomLevel||d.config.neutralZoomLevel,d.config.initialPanX=d.config.initialPanX||0,d.config.initialPanY=d.config.initialPanY||0,d.config.zoomOnDoubleClick=void 0!==d.config.zoomOnDoubleClick?d.config.zoomOnDoubleClick:!0,d.config.zoomOnMouseWheel=void 0!==d.config.zoomOnMouseWheel?d.config.zoomOnMouseWheel:!0,d.config.panOnClickDrag=void 0!==d.config.panOnClickDrag?d.config.panOnClickDrag:!0,d.config.invertMouseWheel=d.config.invertMouseWheel||!1,d.config.chromeUseTransform=d.config.chromeUseTransform||!1;var q=function(a){var b=e.width(),c=e.height(),f=a.width,g=a.height,h=Math.min(b/f,c/g),i=p(h),j=i*d.config.zoomToFitZoomLevelFactor,k=o(j);return{zoomLevel:j,pan:{x:-a.x*k+(b-f*k)/2,y:-a.y*k+(c-g*k)/2}}};d.config.initialZoomToFit?d.base=q(d.config.initialZoomToFit):d.base={zoomLevel:d.config.initialZoomLevel,pan:{x:d.config.initialPanX,y:d.config.initialPanY}},d.model.zoomLevel=d.base.zoomLevel,d.model.isPanning=!1,d.model.pan={x:d.base.pan.x,y:d.base.pan.y},d.previousPosition=void 0,d.dragging=!1,d.panVelocity=void 0,d.zoomAnimation=void 0;var r=function(){if(d.zoomAnimation){d.model.zoomLevel=d.base.zoomLevel+d.zoomAnimation.deltaZoomLevel*d.zoomAnimation.progress;var a=d.zoomAnimation.translationFromZoom(d.model.zoomLevel);d.model.pan.x=d.base.pan.x+a.x,d.model.pan.y=d.base.pan.y+a.y}else d.model.zoomLevel=d.base.zoomLevel,d.model.pan.x=d.base.pan.x,d.model.pan.y=d.base.pan.y;var b=o(d.model.zoomLevel),c="scale("+b+")";if(-1!==navigator.userAgent.indexOf("Chrome")?d.config.chromeUseTransform?(l.style.transformOrigin="0 0",l.style.transform=c):l.style.zoom=b:(l.style.msTransformOrigin="0 0",l.style.msTransform=c,l.style.transformOrigin="0 0",l.style.transform=c,l.style.webkitTransformOrigin="0 0",l.style.webkitTransform=c),d.config.useHardwareAcceleration){var e="translate3d("+d.model.pan.x+"px, "+d.model.pan.y+"px, 0)";k.style.transform=e,k.style.msTransform=e,k.style.webkitTransform=e,k.style.mozTransform=e}else k.style.left=d.model.pan.x,k.style.top=d.model.pan.y},s=function(){var a={x:h.width()/2,y:h.height()/2};return a},t=function(a,b,c){d.zoomAnimation&&(d.base.zoomLevel=d.model.zoomLevel,d.base.pan.x=d.model.pan.x,d.base.pan.y=d.model.pan.y,d.zoomAnimation=void 0),a=Math.max(0,a),a=Math.min(d.config.zoomLevels-1,a);var e=a-d.base.zoomLevel;if(e){c=c||d.config.zoomStepDuration;var g=b||s(),h=o(d.base.zoomLevel),i={x:d.base.pan.x,y:d.base.pan.y},j=function(a){var b=o(a),c={x:g.x-b/h*(g.x-i.x),y:g.y-b/h*(g.y-i.y)};return{x:c.x-i.x,y:c.y-i.y}};d.zoomAnimation={deltaZoomLevel:e,translationFromZoom:j,duration:c,progress:d.config.disableZoomAnimation?1:0},f()}},u=function(a){t(d.base.zoomLevel+d.config.zoomButtonIncrement,a)},v=function(a){t(d.base.zoomLevel-d.config.zoomButtonIncrement,a)},w=function(a){var b=a,c=o(d.base.zoomLevel),e=d.base.pan;return{x:b.x*c+e.x,y:b.y*c+e.y}},x=function(a){var b=a,c=o(d.base.zoomLevel),e=d.base.pan;return{x:1/c*(b.x-e.x),y:1/c*(b.y-e.y)}},y=function(a){d.base=q(a),r()},z=function(a){return Math.sqrt(a.x*a.x+a.y*a.y)},A=!1,B=function(){var a=null;return function(){var b=jQuery.now(),c=a?(b-a)/1e3:0;if(a=b,d.zoomAnimation&&(d.zoomAnimation.progress+=c/d.zoomAnimation.duration,d.zoomAnimation.progress>=1&&(d.zoomAnimation.progress=1,r(),d.base.zoomLevel=d.model.zoomLevel,d.base.pan.x=d.model.pan.x,d.base.pan.y=d.model.pan.y,d.zoomAnimation=void 0,d.config.modelChangedCallback(d.model))),d.panVelocity)for(;c>0;){var e=Math.min(.02,c);c-=e,d.base.pan.x+=d.panVelocity.x*e,d.panVelocity.x*=1-d.config.friction*e,d.base.pan.y+=d.panVelocity.y*e,d.panVelocity.y*=1-d.config.friction*e;var f=z(d.panVelocity);if(f<d.config.haltSpeed){d.panVelocity=void 0,d.config.modelChangedCallback(d.model);break}}r();var g=void 0===d.panVelocity&&void 0===d.zoomAnimation;return g?(C.isRegistered=!1,a=null,!1):(m&&!A&&m(C),!A)}};r();var C=new B;C.isRegistered=!1,d.$on("$destroy",function(){b.unregisterAPI(d.elementId),A=!0}),d.onDblClick=function(a){if(d.config.zoomOnDoubleClick){var b={x:a.pageX-h.offset().left,y:a.pageY-h.offset().top};u(b)}};var D,E;d.onTouchStart=function(a){if(a.preventDefault(),1===a.originalEvent.touches.length)a.pageX=a.originalEvent.touches[0].pageX,a.pageY=a.originalEvent.touches[0].pageY,d.onMousedown(a);else{var b=a.originalEvent.touches[0].pageX-a.originalEvent.touches[1].pageX,c=a.originalEvent.touches[0].pageY-a.originalEvent.touches[1].pageY;E={length:b*b+c*c}}},d.onTouchMove=function(a){if(a.preventDefault(),1===a.originalEvent.touches.length)a.pageX=a.originalEvent.touches[0].pageX,a.pageY=a.originalEvent.touches[0].pageY,d.onMousemove(a);else{var b=a.originalEvent.touches[0].pageX-a.originalEvent.touches[1].pageX,c=a.originalEvent.touches[0].pageY-a.originalEvent.touches[1].pageY,e=b*b+c*c,f=e-E.length;if(Math.abs(f)<100)return;var g=a.originalEvent.touches[1].pageX+b/2,i=a.originalEvent.touches[1].pageY+c/2,j={x:g-h.offset().left,y:i-h.offset().top};t(d.base.zoomLevel+1e-4*f,j),E={length:e}}},d.onTouchEnd=function(a){d.onMouseup(a)},d.onMousedown=function(b){return d.config.panOnClickDrag&&(E={x:b.pageX,y:b.pageY},D=jQuery.now(),d.dragging=!0,d.model.isPanning=!1,a.on("mousemove",d.onMousemove),a.on("mouseup",d.onMouseup),a.on("touchend",d.onTouchEnd),a.on("touchmove",d.onTouchMove)),!1};var F=function(a){a.x=a.x||0,a.y=a.y||0,d.base.pan.x+=a.x,d.base.pan.y+=a.y,r()};d.onMousemove=function(a){a.preventDefault(),a.stopPropagation();var b=jQuery.now(),c=(b-D)/1e3;d.hasPanned=!0,D=b;var e={x:a.pageX-E.x,y:a.pageY-E.y};F(e),d.model.isPanning||g.css("display","block"),d.model.isPanning=!0,d.$emit("panzoom.panning.start"),d.panVelocity={x:e.x/c,y:e.y/c},E={x:a.pageX,y:a.pageY}},d.onMouseup=function(){var b=jQuery.now(),c=(b-D)/1e3;if(d.panVelocity){var e=Math.max(0,Math.pow(c+1,-4)-.2);d.panVelocity.x*=e,d.panVelocity.y*=e}d.dragging=!1,d.model.isPanning=!1,d.$emit("panzoom.padding.stop"),f(),a.off("mousemove",d.onMousemove),a.off("mouseup",d.onMouseup),a.off("touchend",d.onTouchEnd),a.off("touchmove",d.onTouchMove),g.css("display","none")},d.onMouseleave=function(){d.onMouseup()},d.onMouseWheel=function(a,b,c,e){if(d.config.zoomOnMouseWheel){if(a.preventDefault(),d.zoomAnimation)return;var f=e/Math.abs(e);d.config.invertMouseWheel&&(f=-f);var g={x:a.originalEvent.pageX-h.offset().left,y:a.originalEvent.pageY-h.offset().top};0>f?u(g):v(g)}},c={model:d.model,config:d.config,changeZoomLevel:t,zoomIn:u,zoomOut:v,zoomToFit:y,getViewPosition:w,getModelPosition:x}}],link:function(a,d,e){a.elementId=e.id,a.elementId&&b.registerAPI(a.elementId,c),d.on("touchstart",function(b){a.onTouchStart(b)})},template:'<div class="pan-zoom-frame" ng-dblclick="onDblClick($event)" ng-mousedown="onMousedown($event)" msd-wheel="onMouseWheel($event, $delta, $deltaX, $deltaY)" style="position:relative;overflow:hidden;cursor:move"><div class="pan-element" style="position:absolute;left:0px;top:0px"><div class="zoom-element" ng-transclude></div></div></div>',replace:!0}}]),angular.module("panzoomwidget",[]).directive("panzoomwidget",["$document","PanZoomService",function(a,b){var c;return{restrict:"E",transclude:!0,compile:function(){return{pre:function(){},post:function(d,e,f){if(c=f.panzoomId,!c)throw"Error in setup. You must define attribute panzoom-id on the <panzoomwidget> element in order to link it to the id of the <panzoom> element. Ref: ";b.getAPI(c).then(function(b){d.model=b.model,d.config=b.config;var c=e.find(".zoom-slider-widget"),f=!1,g=function(a){return(d.config.zoomLevels-a-1)*d.widgetConfig.zoomLevelHeight},h=function(a){return d.config.zoomLevels-1-a/d.widgetConfig.zoomLevelHeight},i=function(a){var b=a.pageY-e.find(".zoom-slider").offset().top-d.widgetConfig.zoomLevelHeight/2;return h(b)};d.getZoomLevels=function(){for(var a=[],b=d.config.zoomLevels-1;b>=0;b--)a.push(b);return a},d.widgetConfig={zoomLevelHeight:10},d.zoomIn=function(){b.zoomIn()},d.zoomOut=function(){b.zoomOut()},d.onClick=function(a){var c=i(a);b.changeZoomLevel(c)},d.onMousedown=function(){f=!0,a.on("mousemove",d.onMousemove),a.on("mouseup",d.onMouseup)},d.onMousemove=function(a){a.preventDefault();var c=i(a);b.changeZoomLevel(c)},d.onMouseup=function(){f=!1,a.off("mousemove",d.onMousemove),a.off("mouseup",d.onMouseup)},d.onMouseleave=function(){f=!1},setInterval(function(){c.css("top",g(d.model.zoomLevel)+"px")},25)})}}},template:'<div class="panzoomwidget"><div ng-click="zoomIn()" ng-mouseenter="zoomToLevelIfDragging(config.zoomLevels - 1)" class="zoom-button zoom-button-in">+</div><div class="zoom-slider" ng-mousedown="onMousedown()" ng-click="onClick($event)"><div class="zoom-slider-widget" ng-style="{\'height\': widgetConfig.zoomLevelHeight - 2 +\'px\'}"></div><div ng-repeat="zoomLevel in getZoomLevels()"  class="zoom-level zoom-level-{{zoomLevel}}" ng-style="{\'height\': widgetConfig.zoomLevelHeight +\'px\'}"></div></div><div ng-click="zoomOut()" ng-mouseenter="zoomToLevelIfDragging(0)" class="zoom-button zoom-button-out">-</div><div ng-transclude></div></div>',replace:!0}}]),angular.module("panzoom").factory("PanZoomService",["$q",function(a){var b={},c=function(c,d){b[c]||(b[c]=a.defer());var e=b[c];if(e.hasBeenResolved)throw"Internal error: attempt to register a panzoom API but key was already used. Did you declare two <panzoom> directives with the same id?";e.resolve(d),e.hasBeenResolved=!0},d=function(a){delete b[a]},e=function(c){return b[c]||(b[c]=a.defer()),b[c].promise};return{registerAPI:c,unregisterAPI:d,getAPI:e}}]);